let chart;const ctx=document.getElementById("linechart2").getContext("2d");let jsonData,selectedYears=["2023"];const colors=["#41de6e","#84c396","#67bcc6","#217eb8"];function createChart(){let e=`\xc9volution du nombre de voitures \xe9lectriques (${selectedYears.join(", ")}) en France`;document.querySelector(".titre").textContent=e;let t=selectedYears.map(e=>{let t=jsonData.find(t=>t.annee===e);return{label:`Nombre de voitures \xe9lectriques en ${e} en France`,data:t.mois.map(e=>e.valeur),borderColor:colors[parseInt(e)-2020],borderWidth:1,fill:!1}});chart&&chart.destroy(),chart=new Chart(ctx,{type:"line",data:{labels:jsonData[0].mois.map(e=>e.mois),datasets:t},options:{scales:{x:{display:!0,title:{display:!0,text:"Mois"}},y:{display:!0,title:{display:!0,text:"Nombre de voitures \xe9lectriques"}}},plugins:{title:{display:!0,text:e},legend:{display:!0},tooltips:{mode:"index",intersect:!1}}}}),setActiveButton()}function setActiveButton(){let e=document.querySelectorAll("button");e.forEach(e=>{let t=e.getAttribute("data-year");selectedYears.includes(t)?e.classList.add("active"):e.classList.remove("active")})}document.querySelectorAll("button").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();let t=e.target.getAttribute("data-year"),a=selectedYears.indexOf(t);-1===a?selectedYears.push(t):selectedYears.splice(a,1),createChart()})}),fetch("annee.json").then(e=>e.json()).then(e=>{jsonData=e,createChart()}).catch(e=>console.error("Erreur de chargement des donn\xe9es JSON",e)),fetch("secteur.json").then(e=>e.json()).then(e=>{let t=e.data,a=e.options,o={type:"bar",data:t,options:a};var n=new Chart(document.getElementById("barchart"),o)}).catch(e=>console.error("Erreur de chargement du fichier JSON:",e)),fetch("projection.json").then(e=>e.json()).then(e=>{let t=e,a=t.map(e=>e.annee),o=t.map(e=>e.scenario_bas),n=t.map(e=>e.scenario_median),r=t.map(e=>e.scenario_haut),s=t.map(e=>e.annee<="2023"?e.realise:null),i={type:"line",data:{labels:a,datasets:[{label:"Sc\xe9nario Bas",data:o,borderColor:"#05a5e1",borderWidth:1,borderDash:[5,5],fill:!1,zIndex:1},{label:"Sc\xe9nario M\xe9dian",data:n,borderColor:"#8755c8",borderWidth:1,borderDash:[5,5],fill:!1,zIndex:1},{label:"Sc\xe9nario Haut",data:r,borderColor:"#ef426f",borderWidth:1,borderDash:[5,5],fill:!1,zIndex:1},{label:"R\xe9alis\xe9",data:s,borderColor:"#688197",borderWidth:3,fill:"start",zIndex:2},]},options:{scales:{x:{display:!0,title:{display:!0,text:"Ann\xe9e"}},y:{display:!0,title:{display:!0,text:"Nombre de points de charge"}}},plugins:{title:{display:!0,text:"Trajectoire des points de charge ouverts au public \xe0 horizon 2030"},legend:{display:!0},tooltips:{mode:"index",intersect:!1}}}};var l=new Chart(document.getElementById("linechart"),i)}).catch(e=>console.error("Erreur de chargement du fichier JSON:",e));const width=800,height=600,svg=d3.select("#map").attr("width",800).attr("height",600),projection=d3.geoConicConformal().center([2.454071,46.279229]).scale(2600).translate([400,300]),path=d3.geoPath().projection(projection);let currentPath=null,regionData={};const tooltip=d3.select("#tooltip");function showData(e,t){if(tooltip.style("display","block"),e){tooltip.html(`<strong>R\xe9gion : </strong>${e.region}<br><strong>Puissance install\xe9e : </strong>${e.puissance_installee_moyenne_par_point_de_charge.toFixed(2)} kVA<br><strong>\xc9volution sur 12 mois : </strong>${e.evolution_sur_12_mois_de_la_puissance_installee_moyenne_par_point_de_charge.toFixed(2)}%`);let[a,o]=d3.pointer(t,d3.select("#map-container").node());tooltip.style("left",a+"px"),tooltip.style("top",o+"px")}else tooltip.html("Donn\xe9es non disponibles")}function hideData(){tooltip.style("display","none")}d3.json("carte.geojson").then(function(e){d3.json("puissance.json").then(function(t){t.forEach(e=>{regionData[e.code_region]=e});let a=d3.scaleSequential(d3.interpolateBlues).domain([d3.min(t,e=>e.puissance_installee_moyenne_par_point_de_charge),d3.max(t,e=>e.puissance_installee_moyenne_par_point_de_charge),]);svg.selectAll("path").data(e.features).enter().append("path").attr("d",path).attr("stroke","black").attr("stroke-width",.5).attr("fill",e=>a(regionData[e.properties.code_region].puissance_installee_moyenne_par_point_de_charge)).on("mouseover",function(e,t){d3.select(this).classed("highlighted",!0),showData(regionDataItem=regionData[t.properties.code_region],e)}).on("mouseout",function(){d3.select(this).classed("highlighted",!1),hideData()})})});